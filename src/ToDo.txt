REAFACTOR -> wspólne funkcje statyczne dla mastera i slave przerzucić do jednego pliku common w internall 